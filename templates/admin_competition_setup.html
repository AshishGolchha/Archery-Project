{% extends 'base.html' %}
{% block title %}Create Competition{% endblock %}
{% block content %}
<div class="max-w-lg mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-xl font-bold mb-4">Competition Setup</h2>
    <form method="post">
        {{ form.hidden_tag() }}
        <div class="mb-3">{{ form.name.label }}{{ form.name(class_='w-full p-2 border rounded') }}</div>
        <div class="mb-3">{{ form.bow_type.label }}{{ form.bow_type(class_='w-full p-2 border rounded') }}</div>
        <div class="mb-3">{{ form.age_group.label }}{{ form.age_group(class_='w-full p-2 border rounded') }}</div>
        <div class="mb-3">{{ form.gender.label }}{{ form.gender(class_='w-full p-2 border rounded') }}</div>
        <div class="mb-3 flex items-center gap-2">{{ form.is_team_based(id="is_team_based") }}{{ form.is_team_based.label }}</div>
        <!-- ðŸ”¥ Number of Teams (HIDDEN INITIALLY) -->
        <div id="teamFields" class="hidden">
            <div class="mb-3">
                {{ form.num_teams.label }}
                {{ form.num_teams(class_='w-full p-2 border rounded') }}
            </div>
        </div>
        <!-- ðŸ”¢ Number of Students (Always shown but moves down) -->
        <div id="studentsField" class="mb-3">
            {{ form.num_students.label }}
            {{ form.num_students(class_='w-full p-2 border rounded') }}
        </div>
        <div class="mb-3">{{ form.target_distance.label }}{{ form.target_distance(class_='w-full p-2 border rounded') }}</div>
        <div class="mb-3">{{ form.target_serial.label }}{{ form.target_serial(class_='w-full p-2 border rounded') }}</div>
        <div>{{ form.submit(class_='bg-blue-600 text-white px-4 py-2 rounded') }}</div>
    </form>
</div>
<script>
    const teamCheckbox = document.getElementById('is_team_based');
    const teamFields = document.getElementById('teamFields');

    function toggleTeamFields() {
        if (teamCheckbox.checked) {
            teamFields.classList.remove('hidden');
        } else {
            teamFields.classList.add('hidden');
        }
    }

    // On load
    toggleTeamFields();

    // On change
    teamCheckbox.addEventListener('change', toggleTeamFields);
</script>
<script>
const ALLOWED_DISTANCES = {
    "Indian": {
        "Mini Sub Junior": [10, 20],
        "Sub Junior": [20, 30],
        "Junior": [30, 40],
        "Senior": [30, 40, 50]
    },
    "Re-curve": {
        "Mini Sub Junior": [30, 40, 50],
        "Sub Junior": [60],
        "Junior": [70],
        "Senior": [70]
    },
    "Compound": {
        "Mini Sub Junior": [30],
        "Sub Junior": [50],
        "Junior": [50],
        "Senior": [50]
    }
};

const bowSelect = document.querySelector('[name="bow_type"]');
const ageSelect = document.querySelector('[name="age_group"]');
const distanceSelect = document.querySelector('[name="target_distance"]');

function updateDistances() {
    const bow = bowSelect.value;
    const age = ageSelect.value;

    // clear existing options
    distanceSelect.innerHTML = '';

    if (ALLOWED_DISTANCES[bow] && ALLOWED_DISTANCES[bow][age]) {
        ALLOWED_DISTANCES[bow][age].forEach(d => {
            const opt = document.createElement('option');
            opt.value = d;
            opt.textContent = d + "m";
            distanceSelect.appendChild(opt);
        });
    }
}

// run when bow or age changes
bowSelect.addEventListener('change', updateDistances);
ageSelect.addEventListener('change', updateDistances);
</script>

{% endblock %}